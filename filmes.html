<script>
    const apiUrl = 'https://sheetdb.io/api/v1/dlats2maboyum';
    const listaFilmes = document.getElementById('lista-filmes');
    const form = document.getElementById('form-filme');
    const inputFilme = document.getElementById('input-filme');
    let filmesExistentes = [];

    async function carregarFilmes() {
        const res = await fetch(apiUrl);
        const dados = await res.json();

        console.log(dados); // Veja no console como os dados est√£o vindo

        filmesExistentes = dados
            .filter(item => item["Filmes Estranhos"])
            .map(item => item["Filmes Estranhos"].toLowerCase());

        listaFilmes.innerHTML = '';

        dados.forEach(item => {
            const nome = item["Filmes Estranhos"];
            const divFilme = document.createElement('div');
            divFilme.classList.add('filme');

            divFilme.innerHTML = `
                <h3>${nome}</h3>
                <button onclick="apagarFilme('${nome}')">üóëÔ∏è Apagar</button>
                <p>Descri√ß√£o ainda n√£o cadastrada.</p>
            `;

            listaFilmes.appendChild(divFilme);
        });
    }

    async function adicionarFilme(nome) {
        if (filmesExistentes.includes(nome.toLowerCase())) {
            alert('Esse filme j√° est√° na lista!');
            return;
        }

        const bodyData = {
            data: [{ "Filmes Estranhos": nome }]
        };

        const res = await fetch(apiUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(bodyData)
        });

        if (res.ok) {
            alert('Filme adicionado com sucesso!');
            inputFilme.value = '';
            carregarFilmes();
        } else {
            alert('Erro ao adicionar filme. Tente novamente.');
        }
    }

    async function apagarFilme(nome) {
        const res = await fetch(`${apiUrl}/Filmes Estranhos/${nome}`, {
            method: 'DELETE'
        });

        if (res.ok) {
            alert('Filme apagado com sucesso!');
            carregarFilmes();
        } else {
            alert('Erro ao apagar filme.');
        }
    }

    form.addEventListener('submit', e => {
        e.preventDefault();
        const filme = inputFilme.value.trim();
        if (filme) {
            adicionarFilme(filme);
        }
    });

    carregarFilmes();
</script>